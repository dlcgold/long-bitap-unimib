#include "utils.h"

char* charge_file(char* file_name) {

  FILE *fp;
  fp = fopen(file_name, "r"); // apro in lettura
  if (fp == NULL) {
    fprintf(stderr, "Can't open input file\n");
    exit(1);
  }
  
  int i = 0;
  char c = fgetc(fp); // fgetc legge un char dallo stream
  while (c != EOF) { // itero fino a che ho caratteri 
    c = fgetc(fp); // carico in c il carattere successivo
    i++;
  }
  fclose(fp);
  
  fp = fopen(file_name, "r");
  // dichiaro un array di char lungo quanto il file
  char *str = (char*)malloc(sizeof(char) * (i + 1)); 
  str[0] = '\0';
  char cc = fgetc(fp); // fgetc legge un char dallo stream
  while (cc != EOF) { // itero fino a che ho caratteri 
    strncat(str, &cc, 1); // appendo il carattere alla stringa
    cc = fgetc(fp); // carico in c il carattere successivo
  }
  fclose(fp);
  return str;
}

int* charge_u_char(char* pattern, char character){
  int* uc = (int*)malloc(sizeof(int) * (strlen(pattern)));
  for(int i = 0; i < strlen(pattern); i++){
    if(pattern[i] == character)
      uc[i] = 1;
    else
      uc[i] = 0;
  }
  return uc;
}


int charge_u_int(char* pattern, char character){
  int uc = 0;
  for(int i = strlen(pattern); i >= 0; i--){
    if(pattern[i] == character){
      uc = uc + (int)pow(2, i) * 1;
     }else
      uc = uc + (int)pow(2, i) * 0;
  }
  return uc;
}


int* array_bit(int num){
  // per un intero in binario servono log_2(num)+1 cifre binarie
  int bin_l = floor(log(num) / log(2)) + 1;
  int *array_bin = (int*)malloc(sizeof(int) * bin_l);
  // ciclo all'inverso per caricare l'array con il binario
  for(int i = bin_l -1 ; i >=0; i--){
    array_bin[i] = num % 2;
    num = num / 2;
  }
  return array_bin;
}
